Running command: python -m src.main experiment=hgdp_pca metrics=tsa_pearson
[2025-04-07 03:11:23,644][__main__][INFO] - Final Config:
algorithm:
  dimensionality_reduction:
    _target_: src.algorithms.pca.PCAModule
    n_components: 50
    random_state: ${seed}
data:
  batch_size: 32
  num_workers: 1
  cache_dir: ${cache_dir}
  _target_: src.data.hgdp.HGDPDataModule
  mmap_mode: null
  mode: split
  files:
    plink: ./data/HGDP+1KGP/genotypes/no_intersection_less_stringent/gnomad.genomes.v3.1.2.hgdp_tgp.PASSfiltered.newIDs.onlySNPs.noDuplicatePos.noMiss5perc.maf0.01.LDpruned_500_50_0.05.woLowComplexity_noHLA
    metadata: ./data/HGDP+1KGP/gnomad_derived_metadata_with_filtered_sampleids.csv
  filter_qc: true
  filter_related: true
  test_all: true
  remove_recent_migration: false
  precomputed_path: null
  delimiter: ','
callbacks:
  dimensionality_reduction:
    save_embeddings:
      _target_: src.callbacks.dimensionality_reduction.save_embeddings.SaveEmbeddings
      save_dir: ${hydra:runtime.output_dir}
      save_format: csv
      experiment_name: ${name}
    plot_embeddings:
      _target_: src.callbacks.dimensionality_reduction.plot_embeddings.PlotEmbeddings
      save_dir: ${hydra:runtime.output_dir}
      experiment_name: ${name}.png
      figsize:
      - 8
      - 6
      legend: false
      color_by_score: null
trainer: {}
metrics:
  embedding:
    tangent_space:
      _target_: src.metrics.tangent_space.TangentSpaceApproximation
      _partial_: true
      n_neighbors: 15
      variance_threshold: 0.95
      return_per_sample: true
    pearson_correlation:
      _target_: src.metrics.correlation.PearsonCorrelation
      _partial_: true
      num_dists: 100
log_level: info
seed: 42
debug: false
verbose: false
cache_dir: outputs/cache
ckpt_dir: outputs/ckpt
name: hgdp_pca_n_components=${algorithm.dimensionality_reduction.n_components}
eval_only: false
pretrained_ckpt: null

wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
wandb: Currently logged in as: cesar-valdez (cesar-valdez-mcgill-university) to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.19.8
wandb: Run data is saved locally in /network/scratch/c/cesar.valdez/manifold_genetics/wandb/run-20250407_031124-qpjxbg6y
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run hgdp_pca_n_components=50
wandb: ‚≠êÔ∏è View project at https://wandb.ai/cesar-valdez-mcgill-university/manifold_genetics
wandb: üöÄ View run at https://wandb.ai/cesar-valdez-mcgill-university/manifold_genetics/runs/qpjxbg6y
[2025-04-07 03:11:24,708][src.experiment][INFO] - Cache directory ensured at: outputs/cache
[2025-04-07 03:11:24,718][src.data.hgdp_dataset][INFO] - Loading metadata from: /network/scratch/c/cesar.valdez/manifold_genetics/data/HGDP+1KGP/gnomad_derived_metadata_with_filtered_sampleids.csv
[2025-04-07 03:11:24,740][root][INFO] - Successfully loaded metadata with delimiter ','.
[2025-04-07 03:11:24,748][src.data.plink_dataset][INFO] - Loading processed PLINK data from outputs/cache/.1f49e88d37c0644503a5e73fc926daa3.npy
[2025-04-07 03:11:32,478][src.data.precomputed_mixin][INFO] - No precomputed embeddings found or path does not exist.
/network/scratch/c/cesar.valdez/manifold_genetics/src/data/plink_dataset.py:136: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  self._geographic_preservation_indices = self._geographic_preservation_indices[idx]
[2025-04-07 03:11:32,948][src.data.hgdp_dataset][INFO] - Loading metadata from: /network/scratch/c/cesar.valdez/manifold_genetics/data/HGDP+1KGP/gnomad_derived_metadata_with_filtered_sampleids.csv
[2025-04-07 03:11:32,964][root][INFO] - Successfully loaded metadata with delimiter ','.
[2025-04-07 03:11:32,969][src.data.plink_dataset][INFO] - Loading processed PLINK data from outputs/cache/.1f49e88d37c0644503a5e73fc926daa3.npy
[2025-04-07 03:11:39,520][src.data.precomputed_mixin][INFO] - No precomputed embeddings found or path does not exist.
/network/scratch/c/cesar.valdez/manifold_genetics/src/data/plink_dataset.py:136: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  self._geographic_preservation_indices = self._geographic_preservation_indices[idx]
[2025-04-07 03:11:40,262][__main__][INFO] - Instantiating Dimensionality Reduction: PCAModule
[2025-04-07 03:11:40,264][__main__][INFO] - Starting the experiment pipeline...
[2025-04-07 03:11:43,960][__main__][INFO] - Running Dimensionality Reduction (DR) on using unified data:
Train tensor shape: torch.Size([3400, 172152])
Test tensor shape: torch.Size([4094, 172152])
[2025-04-07 03:11:59,202][__main__][INFO] - DR embedding completed with shape: torch.Size([4094, 50])
[2025-04-07 03:11:59,203][__main__][INFO] - Evaluating embeddings (from DR output)...
[2025-04-07 03:11:59,768][src.experiment][INFO] - Reference data shape: (4094, 172152)
[2025-04-07 03:11:59,769][src.experiment][INFO] - Computing embedding metrics for 4094 samples.
[2025-04-07 03:11:59,780][src.metrics.tangent_space][INFO] - TangentSpaceApproximation: Converted embeddings to numpy with shape (4094, 50)
[2025-04-07 03:12:01,381][src.metrics.tangent_space][INFO] - TangentSpaceApproximation: Per-sample local dimensions: [12 12 12 ... 12 12 12]
[2025-04-07 03:12:01,385][src.metrics.correlation][INFO] - Starting Pearson correlation computation with 100 distances.
[2025-04-07 03:20:48,165][src.metrics.correlation][INFO] - Finished Pearson correlation computation.
[2025-04-07 03:20:48,189][src.callbacks.dimensionality_reduction.save_embeddings][INFO] - SaveEmbeddings initialized with directory: /network/scratch/c/cesar.valdez/manifold_genetics/outputs/2025-04-07/03-11-23 and format: csv
[2025-04-07 03:20:48,190][src.callbacks.dimensionality_reduction.save_embeddings][INFO] - Computed save path: /network/scratch/c/cesar.valdez/manifold_genetics/outputs/2025-04-07/03-11-23/embeddings_hgdp_pca_n_components=50_20250407_032048.csv
[2025-04-07 03:20:48,299][src.callbacks.dimensionality_reduction.save_embeddings][INFO] - Saved embeddings successfully to /network/scratch/c/cesar.valdez/manifold_genetics/outputs/2025-04-07/03-11-23/embeddings_hgdp_pca_n_components=50_20250407_032048.csv
[2025-04-07 03:20:48,306][src.callbacks.dimensionality_reduction.plot_embeddings][INFO] - PlotEmbeddings initialized with directory: /network/scratch/c/cesar.valdez/manifold_genetics/outputs/2025-04-07/03-11-23 and experiment name: hgdp_pca_n_components=50.png
[2025-04-07 03:20:48,612][src.callbacks.dimensionality_reduction.plot_embeddings][INFO] - Saved 2D embeddings plot to /network/scratch/c/cesar.valdez/manifold_genetics/outputs/2025-04-07/03-11-23/embedding_plot_hgdp_pca_n_components=50.png_20250407_032048.png
[2025-04-07 03:20:48,752][__main__][INFO] - Aggregated metrics: {'tangent_space': array([12, 12, 12, ..., 12, 12, 12]), 'pearson_correlation': 0.07194365083159855, 'save_embeddings': '/network/scratch/c/cesar.valdez/manifold_genetics/outputs/2025-04-07/03-11-23/embeddings_hgdp_pca_n_components=50_20250407_032048.csv', 'plot_embeddings_plot': <wandb.sdk.data_types.image.Image object at 0x7fc7e98e7ac0>}
wandb:                                                                                
wandb: 
wandb: Run history:
wandb: pearson_correlation ‚ñÅ
wandb: 
wandb: Run summary:
wandb: pearson_correlation 0.07194
wandb:     save_embeddings /network/scratch/c/c...
wandb: 
wandb: üöÄ View run hgdp_pca_n_components=50 at: https://wandb.ai/cesar-valdez-mcgill-university/manifold_genetics/runs/qpjxbg6y
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/cesar-valdez-mcgill-university/manifold_genetics
wandb: Synced 5 W&B file(s), 2 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20250407_031124-qpjxbg6y/logs
[2025-04-07 03:20:49,306][__main__][INFO] - Experiment complete.
